<script>
  // ðŸ”— URL pÃºblica de tu hoja de cÃ¡lculo (CSV)
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTaKAl4VICxc-PMg0giSlbdEq4IQ6NZgMJ_QPpMQhM6M6AynoWVgXkfpcGQDJwqKyFK6TCTY70s_eOd/pub?output=csv";

  const params = new URLSearchParams(window.location.search);
  const codigo = params.get("codigo")?.trim();
  const card = document.getElementById("card");

  if (!codigo) {
    card.innerHTML = `<div class="notfound">CÃ³digo no especificado</div>`;
  } else {
    fetch(SHEET_URL)
      .then(res => res.text())
      .then(csv => {
        const rows = csv.trim().split("\n").map(r => r.split(","));
        const headers = rows[0].map(h => h.trim().toLowerCase());
        const codigoIndex = headers.findIndex(h => h.includes("codigo"));
        const productoIndex = headers.findIndex(h => h.includes("producto"));
        const stockIndex = headers.findIndex(h => h.includes("stock"));

        let encontrado = null;
        for (let i = 1; i < rows.length; i++) {
          const codigoCelda = (rows[i][codigoIndex] || "").toString().trim().replace(/^0+/, "");
          const codigoBuscado = codigo.replace(/^0+/, "");
          if (codigoCelda === codigoBuscado) {
            encontrado = rows[i];
            break;
          }
        }

        if (!encontrado) {
          card.innerHTML = `<div class="notfound">Producto no encontrado</div>`;
        } else {
          const nombre = encontrado[productoIndex] || "(sin nombre)";
          const stock = encontrado[stockIndex] || "0";

          card.innerHTML = `
            <h1>${nombre}</h1>
            <p><strong>CÃ³digo:</strong> ${codigo}</p>
            <p class="stock">Stock actual: ${stock}</p>
          `;
        }
      })
      .catch(err => {
        card.innerHTML = `<div class="notfound">Error al cargar datos</div>`;
        console.error(err);
      });
  }
</script>
